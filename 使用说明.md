```
user root;
master_process off;
daemon off;
error_log /tmp/nginx.log debug;
events {
    worker_connections  1024;
}
rtmp {
    server {
        listen 1935;
        chunk_size 4000;
        application hls {
            rgw_endpoint http://10.139.11.165:8000;
            live on;
            hls_nested on;
            hls_fragment_naming system;
            hls on;
            hls_path /usr/local/nginx/html/;
            hls_fragment 10s;
            hls_playlist_length 50s;
            hls_cleanup on;
        }
    }
}

http {
    server {
        listen  8080;
        location /hls {
            # Serve HLS fragments
            types {
                application/vnd.apple.mpegurl m3u8;
                video/mp2t ts;
            }
            root html;
            expires -1;
        }
        location /s3 {
            default_type text/html;

            content_by_lua_block {
                ngx.say("HelloWorld")
            }
        }
        location /test {
        #    mytest;
        }
    }
}
```

```
/usr/local/openresty/nginx/sbin/nginx -c /usr/local/nginx/conf/nginx.conf
```

```
[root@localhost ~]# cat /etc/hosts
127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4
::1         localhost localhost.localdomain localhost6 localhost6.localdomain6
127.0.0.1 public.eos-beijing-1.cmecloud.cn
```

```
ffmpeg -re -i AVC.mp4 -vcodec libx264 -vprofile baseline -acodec aac -ar 44100 -strict -2 -ac 1 -f flv -s 1280x720 -q 10 "rtmp://public.eos-beijing-1.cmecloud.cn:1935/hls/longlongchannelnamed2"
```

```
[root@localhost ~]# ls -lh  /usr/local/nginx/html/
total 8.0K
drwxr--r--. 2 root root 4.0K Dec 25 04:55 longlongchannelnamed1public
drwxr--r--. 2 root root 4.0K Dec 25 05:01 longlongchannelnamed2public
[root@localhost ~]# ls -lh  /usr/local/nginx/html/longlongchannelnamed1public/
total 65M
-rw-r--r--. 1 root root 2.8M Dec 25 04:50 1514195434592.ts
-rw-r--r--. 1 root root 3.2M Dec 25 04:50 1514195445508.ts
-rw-r--r--. 1 root root 3.8M Dec 25 04:51 1514195457079.ts
-rw-r--r--. 1 root root 4.2M Dec 25 04:51 1514195470736.ts
-rw-r--r--. 1 root root 3.6M Dec 25 04:51 1514195483164.ts
-rw-r--r--. 1 root root 3.1M Dec 25 04:51 1514195495003.ts
-rw-r--r--. 1 root root 3.8M Dec 25 04:52 1514195507620.ts
-rw-r--r--. 1 root root 2.8M Dec 25 04:52 1514195523510.ts
-rw-r--r--. 1 root root 3.3M Dec 25 04:52 1514195535597.ts
-rw-r--r--. 1 root root 3.5M Dec 25 04:52 1514195549153.ts
-rw-r--r--. 1 root root 3.4M Dec 25 04:52 1514195563299.ts
-rw-r--r--. 1 root root 3.7M Dec 25 04:53 1514195577879.ts
-rw-r--r--. 1 root root 3.7M Dec 25 04:53 1514195592545.ts
-rw-r--r--. 1 root root 3.1M Dec 25 04:53 1514195606175.ts
-rw-r--r--. 1 root root 2.7M Dec 25 04:53 1514195619137.ts
-rw-r--r--. 1 root root 3.6M Dec 25 04:54 1514195632946.ts
-rw-r--r--. 1 root root 2.6M Dec 25 04:54 1514195652945.ts
-rw-r--r--. 1 root root 3.5M Dec 25 04:54 1514195666949.ts
-rw-r--r--. 1 root root 3.6M Dec 25 04:54 1514195681101.ts
-rw-r--r--. 1 root root 600K Dec 25 04:55 1514195697231.ts
-rw-r--r--. 1 root root 304K Dec 25 04:55 1514195702126.ts
-rw-r--r--. 1 root root  14K Dec 25 04:55 1514195705586.ts
-rw-r--r--. 1 root root  239 Dec 25 04:55 index.m3u8
```
